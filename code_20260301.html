<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>修仙纪元 - 福利领取</title>
<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:"Microsoft YaHei",sans-serif}
html,body{width:100%;height:100%;overflow-x:hidden;background:#050508;color:#e6e6e6}
a{text-decoration:none}
/* 头部导航-科技感升级 */
.header{
  position:fixed;top:0;left:0;right:0;width:100%;
  padding:16px 6%;background:rgba(5,5,8,0.98);
  display:flex;justify-content:space-between;align-items:center;
  z-index:9998;border-bottom:1px solid #3366ff;
  box-shadow:0 0 15px rgba(51,102,255,0.2);
  max-width:1920px;margin:0 auto;
}
.logo{font-size:24px;font-weight:700;
  background:linear-gradient(90deg,#ffd055,#3366ff);
  -webkit-background-clip:text;color:transparent;
}
.nav{display:flex;gap:26px;align-items:center;}
.nav a{color:#d1d1e0;font-size:15px;font-weight:500;position:relative;cursor:pointer;}
.nav a::after{content:'';position:absolute;bottom:-4px;left:0;width:0;height:2px;background:#3366ff;transition:0.3s;}
.nav a:hover{color:#3366ff;}
.nav a:hover::after{width:100%;}
/* 乱建堂导航入口特殊样式-醒目金色 */
.nav .ljt-nav{color:#ffd055;font-weight:600;}
.nav .ljt-nav::after{background:#ffd055;}
/* 粒子背景-层级优化 */
.particles{
  position:fixed;top:0;left:0;width:100%;height:100%;
  pointer-events:none;z-index:1;
}
/* 福利领取主区域-高级化改造 */
.reserve{
  min-height:100vh;padding:120px 6% 60px;
  display:flex;align-items:center;justify-content:center;
  position:relative;z-index:2;
}
.reserve-box{
  max-width:800px;width:100%;text-align:center;
  background:rgba(15,15,23,0.95);padding:50px 30px;
  border-radius:20px;border:2px solid #3366ff;
  box-shadow:0 0 40px rgba(51,102,255,0.3);
  backdrop-filter:blur(8px);
}
.reserve-title{
  font-size:38px;
  background:linear-gradient(90deg,#ffd055,#3366ff);
  -webkit-background-clip:text;color:transparent;
  margin-bottom:20px;
  text-shadow:0 0 10px rgba(255,208,85,0.3);
}
.reserve-sub{
  font-size:18px;color:#b8b8d4;margin-bottom:30px;line-height:1.6;
}
.reserve-sub span{
  background:linear-gradient(90deg,#ffd055,#00ff99);
  -webkit-background-clip:text;color:transparent;
  font-weight:700;
}
/* 通用按钮-科技感渐变+hover放大 */
.reserve-btn,.draw-btn{
  padding:16px 36px;
  background:linear-gradient(90deg,#ffd055,#3366ff);
  color:#0f0f17;font-weight:700;
  border-radius:12px;font-size:18px;margin-bottom:30px;
  cursor:pointer;transition:0.3s;border:none;
  pointer-events:auto;
  box-shadow:0 0 15px rgba(255,208,85,0.2);
}
.reserve-btn:hover,.draw-btn:hover{
  transform:scale(1.05);
  box-shadow:0 0 20px rgba(51,102,255,0.4);
  background:linear-gradient(90deg,#ffdf8e,#4a7bff);
}
.reserve-btn:disabled,.draw-btn:disabled{
  background:#666;cursor:not-allowed;transform:none;
  box-shadow:none;
}
/* 核心转盘容器-适配高分辨率 */
.lottery-container{
  display:none;
  width:100%;
  max-width:500px;
  margin:0 auto 30px;
  position:relative;
}
/* Canvas转盘-高分辨率核心设置 */
#lotteryCanvas{
  width:100%;
  aspect-ratio:1/1;
  border-radius:50%;
  border:6px solid #ffd055;
  box-shadow:0 0 30px rgba(255,208,85,0.3),inset 0 0 20px rgba(0,0,0,0.5);
  image-rendering: crisp-edges;
}
/* 固定箭头-优化样式 */
.lottery-pointer{
  position:absolute;
  top:50%;
  right:-12px;
  transform:translateY(-50%);
  width:55px;height:32px;
  z-index:100;
  clip-path:polygon(0 50%, 100% 0, 100% 100%);
  background:linear-gradient(90deg,#ffd055,#ffdf8e);
  box-shadow:0 0 10px rgba(255,208,85,0.5);
}
/* 提示文字-优化 */
.reserve-tip{
  color:#a8a8c2;font-size:14px;line-height:1.8;
  margin-bottom:20px;
}
.reserve-tip span{
  color:#00ff99;font-weight:500;
}
.prize-result{
  margin-top:20px;
  font-size:18px;
  font-weight:700;
  background:linear-gradient(90deg,#4CAF50,#00ff99);
  -webkit-background-clip:text;color:transparent;
  line-height:1.6;
}
/* 通用弹窗样式-福利记录/福利规则通用 */
.record-modal,.rule-modal{
  position:fixed;top:0;left:0;width:100%;height:100%;
  background:rgba(0,0,0,0.9);z-index:10000;
  display:none;align-items:center;justify-content:center;
  padding:20px;
  backdrop-filter:blur(10px);
  overflow-y:auto;
}
.record-box,.rule-box{
  max-width:500px;width:100%;
  background:#0f0f17;border:2px solid #3366ff;
  border-radius:16px;padding:40px 30px;
  text-align:center;
  box-shadow:0 0 30px rgba(51,102,255,0.3);
  margin:50px 0;
}
.record-title,.rule-title{
  font-size:24px;
  background:linear-gradient(90deg,#ffd055,#3366ff);
  -webkit-background-clip:text;color:transparent;
  font-weight:700;
  margin-bottom:30px;
}
.record-content{
  color:#e6e6e6;font-size:16px;line-height:1.8;
  margin-bottom:30px;
}
.record-content .prize-name{
  background:linear-gradient(90deg,#ffd055,#00ff99);
  -webkit-background-clip:text;color:transparent;
  font-weight:700;font-size:18px;
  margin:10px 0;
}
.record-content .code-box{
  background:#1a1a2e;border:1px solid #3366ff;
  border-radius:8px;padding:20px;margin:20px 0;
  box-shadow:inset 0 0 10px rgba(0,0,0,0.5);
}
.record-content .code-title{
  font-size:14px;color:#a8a8c2;margin-bottom:10px;
}
.record-content .code{
  font-size:26px;font-weight:800;letter-spacing:4px;
  user-select:none;
  color:#888;
}
/* 福利规则弹窗内容样式 */
.rule-content{
  color:#a8a8c2;font-size:14px;line-height:2;
  text-align:left;
}
.rule-content p{
  margin-bottom:12px;position:relative;padding-left:18px;
}
.rule-content p::before{
  content:'●';color:#00ff99;font-size:10px;position:absolute;left:0;top:50%;transform:translateY(-50%);
}
.rule-content p:last-child{margin-bottom:0;}
.rule-content span{color:#ffd055;font-weight:500;}
/* 通用关闭按钮 */
.close-btn{
  padding:12px 30px;
  background:linear-gradient(90deg,#ffd055,#3366ff);
  color:#0f0f17;font-weight:700;
  border-radius:10px;font-size:16px;border:none;
  cursor:pointer;transition:0.3s;
  box-shadow:0 0 10px rgba(255,208,85,0.2);
  margin-top:15px;
}
.close-btn:hover{
  transform:scale(1.05);
  box-shadow:0 0 15px rgba(51,102,255,0.4);
  background:linear-gradient(90deg,#ffdf8e,#4a7bff);
}
/* 乱建堂弹窗样式 */
.luanjiantang-modal{
  position:fixed;top:0;left:0;width:100%;height:100%;
  background:rgba(0,0,0,0.95);z-index:10001;
  display:none;align-items:center;justify-content:center;
  padding:20px;
  backdrop-filter:blur(15px);
}
.luanjiantang-box{
  max-width:500px;width:100%;
  background:#0f0f17;border:2px solid #ffd055;
  border-radius:20px;padding:50px 30px;
  text-align:center;
  box-shadow:0 0 50px rgba(255,208,85,0.4);
  position:relative;
}
/* 左下角关闭叉点 */
.luanjiantang-close{
  position:absolute;left:20px;bottom:20px;
  width:40px;height:40px;
  color:#ffd055;font-size:28px;font-weight:700;
  cursor:pointer;
  transition:0.3s;
}
.luanjiantang-close:hover{
  color:#fff;transform:scale(1.1);
  text-shadow:0 0 10px #ffd055;
}
/* 进入乱建堂按钮 */
.luanjiantang-btn{
  padding:18px 40px;
  background:linear-gradient(90deg,#ffd055,#ff5e00);
  color:#0f0f17;font-weight:700;
  border-radius:12px;font-size:20px;margin:20px 0 10px;
  cursor:pointer;transition:0.3s;border:none;
  box-shadow:0 0 20px rgba(255,208,85,0.3);
}
.luanjiantang-btn:hover{
  transform:scale(1.05);
  box-shadow:0 0 30px rgba(255,94,0,0.5);
  background:linear-gradient(90deg,#ffdf8e,#ff7a2f);
}
/* 按钮下方引导小字 */
.luanjiantang-tip{
  font-size:16px;color:#b8b8d4;
  line-height:1.5;
}
.luanjiantang-tip span{
  color:#ffd055;font-weight:500;
}
/* 底部版权-优化 */
.footer{
  position:relative;z-index:2;
  background:#000;padding:35px 6%;text-align:center;
  color:#888;border-top:1px solid #1a1a40;
  margin-top:20px;
}
/* 回到顶部按钮-科技感 */
.toTop{
  position:fixed;right:20px;bottom:30px;
  width:48px;height:48px;
  background:#3366ff;color:#fff;
  border-radius:50%;display:flex;align-items:center;justify-content:center;
  font-size:20px;cursor:pointer;z-index:9998;
  opacity:0;transform:translateY(20px);
  transition:0.3s;
  border:1px solid #4a7bff;box-shadow:0 0 10px rgba(51,102,255,0.5);
}
.toTop.show{opacity:1;transform:translateY(0);}
.toTop:hover{
  background:#4a7bff;box-shadow:0 0 15px rgba(51,102,255,0.8);
}
/* 手机端适配-全尺寸兼容 */
@media (max-width:768px){
  .reserve-title{font-size:30px;}
  .reserve-sub{font-size:16px;}
  .reserve-btn,.draw-btn{padding:14px 30px;font-size:16px;}
  .nav{gap:16px;}
  .nav a{font-size:14px;}
  .lottery-pointer{width:45px;height:26px;right:-10px;}
  .record-content .code{font-size:22px;letter-spacing:2px;}
  .reserve-box{padding:40px 20px;}
  .record-box,.rule-box{padding:30px 20px;}
  .rule-title,.record-title{font-size:22px;}
  .rule-content{font-size:13px;}
  /* 乱建堂弹窗手机适配 */
  .luanjiantang-box{padding:40px 20px;}
  .luanjiantang-btn{padding:16px 36px;font-size:18px;}
  .luanjiantang-tip{font-size:14px;}
  .luanjiantang-close{width:35px;height:35px;font-size:24px;}
}
@media (max-width:480px){
  .lottery-container{max-width:300px;}
  .reserve-title{font-size:26px;}
  /* 乱建堂弹窗小屏适配 */
  .luanjiantang-btn{padding:14px 30px;font-size:16px;}
}
</style>
</head>
<body>
<!-- 动态粒子背景 -->
<canvas class="particles" id="particles"></canvas>
<!-- 头部导航-新增乱建堂全局入口 -->
<div class="header">
  <div class="logo">修仙纪元</div>
  <div class="nav">
    <a href="https://fengyedev.kesug.com" target="_blank">返回官网</a>
    <a href="luanjiantang.html" target="_blank" class="ljt-nav">乱建堂</a>
    <a href="javascript:;" id="recordBtn">福利记录</a>
    <a href="javascript:;" id="ruleBtn">福利规则</a>
  </div>
</div>
<!-- 福利领取+转盘主内容 -->
<div class="reserve">
  <div class="reserve-box">
    <h2 class="reserve-title">修仙纪元 · 专属福利领取</h2>
    <p class="reserve-sub">点击领取即解锁<span>专属幸运转盘</span>，游戏福利100%中奖，<span>每人仅限1次</span>领取机会！</p>
    <button class="reserve-btn" id="reserveBtn">立即领取福利</button>
    <p class="reserve-tip" id="reserveTip">
      官方交流群：212077324 | 风野工作室 倾力打造<br>
      <span>领取成功后解锁转盘，礼包码将在指定时间正式揭晓！</span>
    </p>
    <div class="lottery-container" id="lotteryBox">
      <div class="lottery-pointer"></div>
      <canvas id="lotteryCanvas"></canvas>
    </div>
    <button class="draw-btn" id="drawBtn" style="display:none;">开始抽福利</button>
    <div class="prize-result" id="prizeResult"></div>
  </div>
</div>
<!-- 福利记录弹窗 -->
<div class="record-modal" id="recordModal">
  <div class="record-box">
    <div class="record-title">我的福利记录</div>
    <div class="record-content" id="recordContent"></div>
    <button class="close-btn" id="closeRecordBtn">关闭</button>
  </div>
</div>
<!-- 福利规则弹窗 -->
<div class="rule-modal" id="ruleModal">
  <div class="rule-box">
    <div class="rule-title">修仙纪元专属福利领取规则</div>
    <div class="rule-content">
      <p>1. 本页面为《修仙纪元》官方唯一福利领取渠道，点击【立即领取福利】即可获得转盘抽奖资格，<span>每个账号仅限1次</span>领取及抽奖机会，不可重复参与。</p>
      <p>2. 成功领取福利后解锁幸运转盘，点击【开始抽福利】即可参与抽奖，所有奖品100%中奖，无空奖设置。</p>
      <p>3. 抽奖成功后将生成个人专属福利礼包码，礼包码<span>将在未知指定时间正式揭晓</span>，揭晓信息将第一时间在官方QQ交流群发布。</p>
      <p>4. 礼包码揭晓后，可在《修仙纪元》游戏内找到福利兑换入口，输入礼包码即可领取对应奖品，奖品将直接发放至游戏内邮箱。</p>
      <p>5. 福利礼包码为个人专属，<span>不可转赠、不可交易、不可重复使用</span>，若因个人原因泄露礼包码导致奖品被领，工作室不承担任何责任。</p>
      <p>6. 参与本活动即视为认可本规则，风野工作室有权在法律法规允许的范围内对本活动规则进行解释和调整。</p>
      <p>7. 活动期间若发现使用外挂、脚本等违规方式参与活动，工作室将直接取消其活动资格及所有奖品，情节严重者将封禁游戏账号。</p>
      <p>8. 官方QQ交流群：<span>212077324</span>，所有福利相关通知、礼包码揭晓、问题答疑均在群内进行，敬请关注。</p>
    </div>
    <button class="close-btn" id="closeRuleBtn">关闭</button>
  </div>
</div>
<!-- 乱建堂弹窗 -->
<div class="luanjiantang-modal" id="luanjiantangModal">
  <div class="luanjiantang-box">
    <div class="luanjiantang-close" id="luanjiantangClose">×</div>
    <button class="luanjiantang-btn" id="luanjiantangBtn">进入乱建堂</button>
    <p class="luanjiantang-tip">抽完福利觉得无聊，那就来试试<span>乱建堂</span>，里面都是我乱建的</p>
  </div>
</div>
<!-- 底部版权 -->
<div class="footer">
  <p>© 2026 风野工作室 修仙纪元 版权所有 | 禁止盗用</p>
</div>
<!-- 回到顶部按钮 -->
<div class="toTop" id="toTop">↑</div>
<script>
// 核心配置区
const prizeList = [
  { name: '灵石×2000', probability: 15, color: '#1a1a2e', textColor: '#ffd055' },
  { name: '紫色随机装备×1', probability: 2, color: '#4a148c', textColor: '#e1bee7' },
  { name: '橙色装备碎片×3', probability: 8, color: '#e65100', textColor: '#ffe0b2' },
  { name: '稀有材料包×1', probability: 5, color: '#2e7d32', textColor: '#c8e6c9' },
  { name: '随机绿色功法×1', probability: 12, color: '#004d40', textColor: '#b2dfdb' },
  { name: '灵石×500', probability: 30, color: '#0f0f17', textColor: '#ffd055' },
  { name: '丹药礼包×1', probability: 20, color: '#880e4f', textColor: '#f8bbd0' },
  { name: '随机蓝色装备×1', probability: 8, color: '#0d47a1', textColor: '#bbdefb' }
];
// 转盘核心逻辑
const canvas = document.getElementById('lotteryCanvas');
const ctx = canvas.getContext('2d');
const drawBtn = document.getElementById('drawBtn');
const prizeResult = document.getElementById('prizeResult');
const reserveBtn = document.getElementById('reserveBtn');
const reserveTip = document.getElementById('reserveTip');
const lotteryBox = document.getElementById('lotteryBox');
const totalDeg = Math.PI * 2;
let canvasWidth = 0, canvasHeight = 0, centerX = 0, centerY = 0, radius = 0;
let currentRotation = 0, isRunning = false;
let isDrawn = localStorage.getItem('xiuxian_drawn') === '1';
let isReserved = localStorage.getItem('xiuxian_reserved') === '1';
// 生成礼包码
function generateGiftCode() {
  const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
  let code = '';
  for (let i = 0; i < 8; i++) code += chars.charAt(Math.floor(Math.random() * chars.length));
  return code;
}
// 初始化转盘
function initCanvas() {
  const containerWidth = canvas.parentElement.offsetWidth || 500;
  canvasWidth = canvas.height = canvas.width = containerWidth * 2;
  canvasHeight = containerWidth * 2;
  centerX = canvasWidth / 2;
  centerY = canvasHeight / 2;
  radius = canvasWidth / 2 - 20;
  ctx.imageSmoothingEnabled = true;
  ctx.imageSmoothingQuality = 'high';
  drawWheel();
}
// 绘制转盘
function drawWheel(rotation = 0) {
  ctx.clearRect(0, 0, canvasWidth, canvasHeight);
  ctx.save();
  ctx.translate(centerX, centerY);
  ctx.rotate(rotation);
  ctx.translate(-centerX, -centerY);
  let startAngle = 0;
  for (let i = 0; i < prizeList.length; i++) {
    const prize = prizeList[i];
    const angle = (prize.probability / 100) * totalDeg;
    const endAngle = startAngle + angle;
    ctx.beginPath();
    ctx.moveTo(centerX, centerY);
    ctx.arc(centerX, centerY, radius, startAngle, endAngle);
    ctx.closePath();
    ctx.fillStyle = prize.color;
    ctx.fill();
    ctx.strokeStyle = '#ffd055';
    ctx.lineWidth = 2;
    ctx.stroke();
    ctx.save();
    const textAngle = startAngle + angle / 2;
    ctx.translate(centerX + Math.cos(textAngle) * (radius * 0.65), centerY + Math.sin(textAngle) * (radius * 0.65));
    ctx.rotate(textAngle + Math.PI / 2);
    ctx.fillStyle = prize.textColor;
    ctx.font = 'bold 28px Microsoft YaHei';
    ctx.textAlign = 'center';
    ctx.textBaseline = 'middle';
    const textLines = prize.name.split('×');
    ctx.fillText(textLines[0], 0, -16);
    if (textLines[1]) ctx.fillText('×' + textLines[1], 0, 16);
    ctx.font = '24px Microsoft YaHei';
    ctx.fillText(prize.probability + '%', 0, 44);
    ctx.restore();
    startAngle = endAngle;
  }
  const gradient = ctx.createLinearGradient(0, 0, centerX*2, 0);
  gradient.addColorStop(0, '#ffd055');
  gradient.addColorStop(1, '#3366ff');
  ctx.beginPath();
  ctx.arc(centerX, centerY, 60, 0, totalDeg);
  ctx.fillStyle = gradient;
  ctx.fill();
  ctx.strokeStyle = '#fff';
  ctx.lineWidth = 4;
  ctx.stroke();
  ctx.fillStyle = '#0f0f17';
  ctx.font = 'bold 32px Microsoft YaHei';
  ctx.textAlign = 'center';
  ctx.textBaseline = 'middle';
  ctx.fillText('抽福利', centerX, centerY);
  ctx.restore();
}
// 抽奖逻辑
function startDraw() {
  if (isRunning || isDrawn) return;
  isRunning = true;
  drawBtn.disabled = true;
  prizeResult.innerText = '转盘转动中，祝你抽中稀有福利！';
  const random = Math.random() * 100;
  let currentProb = 0, winIndex = 0;
  for (let i = 0; i < prizeList.length; i++) {
    currentProb += prizeList[i].probability;
    if (random <= currentProb) { winIndex = i; break; }
  }
  const winPrize = prizeList[winIndex];
  let winStartAngle = 0;
  for (let i = 0; i < winIndex; i++) winStartAngle += (prizeList[i].probability / 100) * totalDeg;
  const winCenterAngle = winStartAngle + (prizeList[winIndex].probability / 100) * totalDeg / 2;
  const totalRotation = totalDeg * 10 + (totalDeg - winCenterAngle);
  const duration = 6000;
  const startTime = Date.now();
  function animateRotate() {
    const elapsed = Date.now() - startTime;
    const progress = Math.min(elapsed / duration, 1);
    const easeProgress = 1 - Math.pow(1 - progress, 3);
    currentRotation = totalRotation * easeProgress;
    drawWheel(currentRotation);
    if (progress < 1) requestAnimationFrame(animateRotate);
    else {
      isRunning = false;
      isDrawn = true;
      const giftCode = generateGiftCode();
      localStorage.setItem('xiuxian_drawn', '1');
      localStorage.setItem('xiuxian_prize', winPrize.name);
      localStorage.setItem('xiuxian_giftcode', giftCode);
      drawBtn.innerText = '已抽福利';
      prizeResult.innerHTML = `恭喜你！抽中【<span style="color:#ffd055">${winPrize.name}</span>】！<br>专属礼包码已生成，<span style="color:#00ff99">将在未知时间正式揭晓</span>，可在「福利记录」中查看`;
      // 抽奖后弹出乱建堂弹窗
      document.getElementById('luanjiantangModal').style.display = 'flex';
      document.body.style.overflow = 'hidden';
    }
  }
  animateRotate();
}
// 福利记录&规则弹窗逻辑
const recordBtn = document.getElementById('recordBtn');
const recordModal = document.getElementById('recordModal');
const recordContent = document.getElementById('recordContent');
const closeRecordBtn = document.getElementById('closeRecordBtn');
const ruleBtn = document.getElementById('ruleBtn');
const ruleModal = document.getElementById('ruleModal');
const closeRuleBtn = document.getElementById('closeRuleBtn');
// 打开福利记录
recordBtn.addEventListener('click', () => {
  const prize = localStorage.getItem('xiuxian_prize');
  const giftCode = localStorage.getItem('xiuxian_giftcode');
  if (!prize || !giftCode) {
    recordContent.innerHTML = '<p>您还未参与福利领取</p><p>完成福利领取并参与抽奖后，即可查看福利奖励</p><p>官方QQ交流群：212077324</p>';
  } else {
    recordContent.innerHTML = `
      <p>您已成功参与《修仙纪元》专属福利领取</p>
      <p class="prize-name">抽中福利：${prize}</p>
      <div class="code-box">
        <p class="code-title">专属福利礼包码（未知时间正式揭晓）</p>
        <p class="code">●●●●●●●●</p>
      </div>
      <p>礼包码揭晓信息将第一时间在官方QQ交流群发布！</p>
      <p>官方QQ交流群：<span style="color:#ffd055">212077324</span></p>
      <p>请持续关注群内通知，切勿错过礼包码揭晓时间！</p>
    `;
  }
  recordModal.style.display = 'flex';
  document.body.style.overflow = 'hidden';
});
// 打开福利规则
ruleBtn.addEventListener('click', () => {
  ruleModal.style.display = 'flex';
  document.body.style.overflow = 'hidden';
});
// 关闭弹窗
closeRecordBtn.addEventListener('click', () => { recordModal.style.display = 'none'; document.body.style.overflow = 'auto'; });
closeRuleBtn.addEventListener('click', () => { ruleModal.style.display = 'none'; document.body.style.overflow = 'auto'; });
// 点击外部关闭
recordModal.addEventListener('click', (e) => { if (e.target === recordModal) { recordModal.style.display = 'none'; document.body.style.overflow = 'auto'; } });
ruleModal.addEventListener('click', (e) => { if (e.target === ruleModal) { ruleModal.style.display = 'none'; document.body.style.overflow = 'auto'; } });
// 乱建堂弹窗逻辑
const luanjiantangModal = document.getElementById('luanjiantangModal');
const luanjiantangClose = document.getElementById('luanjiantangClose');
const luanjiantangBtn = document.getElementById('luanjiantangBtn');
// 左下角叉点关闭
luanjiantangClose.addEventListener('click', () => {
  luanjiantangModal.style.display = 'none';
  document.body.style.overflow = 'auto';
});
// 进入按钮跳转luanjiantang.html
luanjiantangBtn.addEventListener('click', () => {
  window.open('luanjiantang.html', '_blank');
  luanjiantangModal.style.display = 'none';
  document.body.style.overflow = 'auto';
});
// 页面初始化
window.onload = function() {
  initCanvas();
  if (isReserved) {
    reserveBtn.disabled = true;
    reserveBtn.innerText = '已领取福利';
    reserveTip.innerHTML = '<span style="color:#00ff99">✅ 你已完成福利领取，可参与转盘抽福利！</span>';
    lotteryBox.style.display = 'block';
    if (isDrawn) {
      drawBtn.disabled = true;
      drawBtn.innerText = '已抽福利';
      const savedPrize = localStorage.getItem('xiuxian_prize');
      prizeResult.innerText = `你已完成福利抽奖，抽中【${savedPrize}】，礼包码将在未知时间揭晓`;
    } else {
      drawBtn.style.display = 'inline-block';
    }
  }
}
// 窗口适配
window.addEventListener('resize', initCanvas);
// 领取福利按钮
reserveBtn.addEventListener('click', function() {
  if (isReserved) return;
  isReserved = true;
  localStorage.setItem('xiuxian_reserved', '1');
  reserveBtn.disabled = true;
  reserveBtn.innerText = '已领取福利';
  reserveTip.innerHTML = '<span style="color:#00ff99">✅ 福利领取成功！已为你解锁转盘抽奖资格！</span>';
  lotteryBox.style.display = 'block';
  drawBtn.style.display = 'inline-block';
});
// 抽奖按钮
drawBtn.addEventListener('click', startDraw);
// 回到顶部
const toTop = document.getElementById('toTop');
window.addEventListener('scroll', () => { toTop.classList.toggle('show', window.scrollY > 300); });
toTop.addEventListener('click', () => { window.scrollTo({ top: 0, behavior: 'smooth' }); });
// 粒子背景
const particlesCanvas = document.getElementById('particles');
const particlesCtx = particlesCanvas.getContext('2d');
let pWidth, pHeight, points = [];
let mouseX = null, mouseY = null;
function resizeParticles() {
  pWidth = particlesCanvas.width = window.innerWidth;
  pHeight = particlesCanvas.height = window.innerHeight;
}
window.addEventListener('resize', resizeParticles);
resizeParticles();
class Particle {
  constructor() {
    this.x = Math.random() * pWidth;
    this.y = Math.random() * pHeight;
    this.vx = (Math.random() - 0.5) * 0.15;
    this.vy = (Math.random() - 0.5) * 0.15;
    this.radius = Math.random() * 1.2 + 0.4;
    const colors = ['rgba(255,208,85,', 'rgba(51,102,255,', 'rgba(0,255,153,'];
    this.color = colors[Math.floor(Math.random() * colors.length)];
    this.alpha = Math.random() * 0.35 + 0.2;
  }
  update() {
    this.x += this.vx;
    this.y += this.vy;
    if (this.x < 0 || this.x > pWidth) this.vx *= -1;
    if (this.y < 0 || this.y > pHeight) this.vy *= -1;
    if (mouseX !== null && mouseY !== null) {
      const dx = this.x - mouseX;
      const dy = this.y - mouseY;
      const distance = Math.hypot(dx, dy);
      if (distance < 100) {
        const angle = Math.atan2(dy, dx);
        this.vx += Math.cos(angle) * 0.01;
        this.vy += Math.sin(angle) * 0.01;
      }
    }
  }
  draw() {
    particlesCtx.fillStyle = `${this.color}${this.alpha})`;
    particlesCtx.beginPath();
    particlesCtx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
    particlesCtx.fill();
  }
}
for (let i = 0; i < 180; i++) points.push(new Particle());
window.addEventListener('mousemove', e => { mouseX = e.clientX; mouseY = e.clientY });
window.addEventListener('mouseout', () => { mouseX = mouseY = null });
window.addEventListener('touchmove', e => { mouseX = e.touches[0].clientX; mouseY = e.touches[0].clientY });
window.addEventListener('touchstart', e => { mouseX = e.touches[0].clientX; mouseY = e.touches[0].clientY });
window.addEventListener('touchend', () => { mouseX = mouseY = null });
function animateParticles() {
  particlesCtx.clearRect(0, 0, pWidth, pHeight);
  points.forEach(p => { p.update(); p.draw() });
  requestAnimationFrame(animateParticles);
}
animateParticles();
</script>
</body>
</html>
